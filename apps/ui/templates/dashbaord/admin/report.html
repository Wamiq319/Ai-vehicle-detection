{% extends "dashbaord/admin/base_admin.html" %} {% block content %}

<div class="max-w-7xl mx-auto space-y-10">
  <!-- Title -->
  <h2 class="text-3xl font-bold text-gray-800">Reports Dashboard</h2>

  <!-- Date Range Filter -->
  <div class="bg-white rounded-xl shadow p-6 border">
    <form method="get" class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
      <input type="hidden" name="mode" value="range" />
      <div>
        <label class="block text-sm font-medium text-gray-600"
          >Start Date</label
        >
        <input
          type="date"
          name="start_date"
          value="{{ selected.start_date }}"
          class="w-full border rounded-lg px-3 py-2 text-center"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-600">End Date</label>
        <input
          type="date"
          name="end_date"
          value="{{ selected.end_date }}"
          class="w-full border rounded-lg px-3 py-2 text-center"
        />
      </div>
      <div class="flex justify-end">
        <button
          class="px-6 py-2 bg-blue-700 text-white rounded-lg font-semibold hover:bg-blue-800 transition"
        >
          Apply
        </button>
      </div>
    </form>
  </div>

  <!-- KPIs -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
    <div
      class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-lg shadow text-center"
    >
      <div class="text-5xl">üöó</div>
      <div class="text-sm opacity-80">Total Vehicles</div>
      <div class="text-3xl font-bold">{{ totals.vehicles }}</div>
    </div>
    <div
      class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-lg shadow text-center"
    >
      <div class="text-5xl">üí∞</div>
      <div class="text-sm opacity-80">Total Revenue</div>
      <div class="text-3xl font-bold">{{ totals.revenue }}</div>
    </div>
    <div
      class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-lg shadow text-center"
    >
      <div class="text-5xl">üìä</div>
      <div class="text-sm opacity-80">Avg Revenue/Vehicle</div>
      <div class="text-3xl font-bold">{{ avg_revenue_per_vehicle }}</div>
    </div>
    <div
      class="bg-gradient-to-r from-pink-500 to-pink-600 text-white p-6 rounded-lg shadow text-center"
    >
      <div class="text-5xl">üèÜ</div>
      <div class="text-sm opacity-80">Top Type</div>
      <div class="text-xl font-bold capitalize">
        {% if top_type %} {{ top_type.vehicle_type }} {% else %} N/A {% endif %}
      </div>
    </div>
  </div>

  <!-- Advanced Insights -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="bg-white rounded-xl shadow p-6 border">
      <h3 class="font-bold text-lg mb-2">üö¶ Busiest Day</h3>
      {% if busiest_day %}
      <p class="text-gray-800 text-lg font-semibold">
        {{ busiest_day.day }} ‚Üí {{ busiest_day.vehicles }} vehicles
      </p>
      {% else %}
      <p class="text-gray-500">No data</p>
      {% endif %}
    </div>
    <div class="bg-white rounded-xl shadow p-6 border">
      <h3 class="font-bold text-lg mb-2">‚è∞ Busiest Hour</h3>
      {% if busiest_hour %}
      <p class="text-gray-800 text-lg font-semibold">
        {{ busiest_hour.hour|date:"H:i" }} ‚Üí {{ busiest_hour.vehicles }}
        vehicles
      </p>
      {% else %}
      <p class="text-gray-500">No data</p>
      {% endif %}
    </div>
  </div>

  <!-- Breakdown by Vehicle Type -->
  <div class="bg-white rounded-xl shadow p-6 border">
    <h3 class="font-bold text-lg mb-4">Breakdown by Vehicle Type</h3>
    <table class="w-full text-sm border border-gray-300">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-center border border-gray-300">Type</th>
          <th class="p-2 text-center border border-gray-300">Vehicles</th>
          <th class="p-2 text-center border border-gray-300">Revenue (RS)</th>
        </tr>
      </thead>
      <tbody>
        {% for row in by_type %}
        <tr class="{% cycle 'bg-white' 'bg-gray-50' %}">
          <td class="p-2 text-center border border-gray-300 capitalize">
            {{ row.vehicle_type }}
          </td>
          <td class="p-2 text-center border border-gray-300">
            {{ row.count }}
          </td>
          <td class="p-2 text-center border border-gray-300">
            {{ row.revenue }}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="p-2 text-center text-gray-500">No data</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Daily Trend -->
  <div class="bg-white rounded-xl shadow p-6 border">
    <h3 class="font-bold text-lg mb-4">Daily Traffic & Revenue</h3>
    <table class="w-full text-sm border border-gray-300">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-center border border-gray-300">Date</th>
          <th class="p-2 text-center border border-gray-300">Vehicles</th>
          <th class="p-2 text-center border border-gray-300">Revenue (RS)</th>
        </tr>
      </thead>
      <tbody>
        {% for d in by_day %}
        <tr class="{% cycle 'bg-white' 'bg-gray-50' %}">
          <td class="p-2 text-center border border-gray-300">{{ d.day }}</td>
          <td class="p-2 text-center border border-gray-300">
            {{ d.vehicles }}
          </td>
          <td class="p-2 text-center border border-gray-300">
            {{ d.revenue }}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="p-2 text-center text-gray-500">No data</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Hourly Trend -->
  <div class="bg-white rounded-xl shadow p-6 border">
    <h3 class="font-bold text-lg mb-4">Hourly Traffic</h3>
    <table class="w-full text-sm border border-gray-300">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-center border border-gray-300">Hour</th>
          <th class="p-2 text-center border border-gray-300">Vehicles</th>
        </tr>
      </thead>
      <tbody>
        {% for h in by_hour %}
        <tr class="{% cycle 'bg-white' 'bg-gray-50' %}">
          <td class="p-2 text-center border border-gray-300">
            {{ h.hour|date:"H:i" }}
          </td>
          <td class="p-2 text-center border border-gray-300">
            {{ h.vehicles }}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2" class="p-2 text-center text-gray-500">No data</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Anomalies -->
  <div class="bg-red-50 rounded-xl shadow p-6 border">
    <h3 class="font-bold text-red-700 text-lg mb-4">
      ‚ö†Ô∏è Anomalies (Possible Fraud)
    </h3>
    {% if anomalies %}
    <table class="w-full text-sm border border-gray-300">
      <thead class="bg-red-100">
        <tr>
          <th class="p-2 text-center border border-gray-300">Type</th>
          <th class="p-2 text-center border border-gray-300">Toll Rate</th>
          <th class="p-2 text-center border border-gray-300">Detected At</th>
        </tr>
      </thead>
      <tbody>
        {% for a in anomalies %}
        <tr class="{% cycle 'bg-white' 'bg-gray-50' %}">
          <td class="p-2 text-center border border-gray-300 capitalize">
            {{ a.vehicle_type }}
          </td>
          <td class="p-2 text-center border border-gray-300">
            {{ a.toll_rate }}
          </td>
          <td class="p-2 text-center border border-gray-300">
            {{ a.detected_at }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="text-gray-600">No anomalies detected.</p>
    {% endif %}
  </div>

  <!-- Recent Detections -->
  <div class="bg-white rounded-xl shadow p-6 border">
    <h3 class="font-bold text-lg mb-4">Recent Detections</h3>
    <table class="w-full text-sm border border-gray-300">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-center border border-gray-300">Type</th>
          <th class="p-2 text-center border border-gray-300">Toll Rate</th>
          <th class="p-2 text-center border border-gray-300">Detected At</th>
        </tr>
      </thead>
      <tbody>
        {% for d in detections %}
        <tr class="{% cycle 'bg-white' 'bg-gray-50' %}">
          <td class="p-2 text-center border border-gray-300 capitalize">
            {{ d.vehicle_type }}
          </td>
          <td class="p-2 text-center border border-gray-300">
            RS {{ d.toll_rate }}
          </td>
          <td class="p-2 text-center border border-gray-300">
            {{ d.detected_at }}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="p-2 text-center text-gray-500">
            No detections
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
