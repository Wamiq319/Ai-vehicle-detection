{% extends "dashbaord/admin/base_admin.html" %} {% block content %}

<!-- Messages -->
{% if messages %}
<div class="mb-6">
  {% for message in messages %}
  <div
    class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-100 text-red-800 border border-red-200{% else %}bg-blue-100 text-blue-800 border border-blue-200{% endif %}"
  >
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- Existing Toll Rate Section -->
<div class="max-w-3xl mx-auto bg-white rounded-2xl shadow p-8 mb-10">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-blue-800 flex items-center gap-2">
      <span>🚦</span> Toll Rates
    </h2>
  </div>

  <div id="rates-display" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <!-- Truck -->
    <div
      class="bg-blue-50 rounded-lg p-6 border border-blue-200 flex flex-col items-center"
    >
      <span class="text-5xl mb-2">🚛</span>
      <h3 class="text-lg font-bold text-blue-800 mb-2">Truck</h3>
      <p class="text-2xl font-bold text-gray-900">
        <span class="text-lg font-semibold">RS</span>{{ rates.truck }}
      </p>
    </div>

    <!-- Car -->
    <div
      class="bg-blue-50 rounded-lg p-6 border border-blue-200 flex flex-col items-center"
    >
      <span class="text-5xl mb-2">🚗</span>
      <h3 class="text-lg font-bold text-blue-800 mb-2">Car</h3>
      <p class="text-2xl font-bold text-gray-900">
        <span class="text-lg font-semibold">RS</span>{{ rates.car }}
      </p>
    </div>

    <!-- Bolan -->
    <div
      class="bg-blue-50 rounded-lg p-6 border border-blue-200 flex flex-col items-center"
    >
      <span class="text-5xl mb-2">🚐</span>
      <h3 class="text-lg font-bold text-blue-800 mb-2">Bolan</h3>
      <p class="text-2xl font-bold text-gray-900">
        <span class="text-lg font-semibold">RS</span>{{ rates.bolan }}
      </p>
    </div>
  </div>
</div>

<!-- Video Upload & Stream Section -->
<div class="max-w-3xl mx-auto bg-white rounded-2xl shadow p-8">
  <h2 class="text-2xl font-bold text-blue-800 flex items-center gap-2 mb-6">
    <span>📹</span> Vehicle Detection Input
  </h2>

  <!-- Upload Video -->
  <form
    method="POST"
    action="{% url 'detections:upload_video' %}"
    enctype="multipart/form-data"
    class="mb-8"
  >
    {% csrf_token %}
    <div
      class="flex flex-col items-center border-2 border-dashed border-blue-300 rounded-xl p-6 hover:bg-blue-50 transition"
    >
      <input
        type="file"
        name="video_file"
        accept="video/*"
        class="hidden"
        id="video-input"
        required
      />
      <label
        for="video-input"
        class="cursor-pointer text-blue-700 font-semibold"
      >
        ⬆️ Click to Upload Video
      </label>
      <p class="text-sm text-gray-500 mt-2">Supported formats: MP4, AVI, MOV</p>
      <video
        id="video-preview"
        class="mt-4 w-full rounded-lg border hidden"
        controls
      ></video>
    </div>

    <div class="flex justify-end mt-6">
      <button
        type="submit"
        class="px-6 py-3 bg-blue-700 text-white rounded-lg shadow hover:bg-blue-800 transition"
      >
        🚀 Process Video
      </button>
    </div>
  </form>

  <!-- Connect Live Stream -->
  <div
    class="flex flex-col items-center border border-blue-200 rounded-xl p-6 bg-blue-50"
  >
    <span class="text-5xl mb-3">🎥</span>
    <h3 class="text-lg font-bold text-blue-800 mb-3">Connect Live Stream</h3>
    <p class="text-gray-600 mb-4 text-center">
      This option will allow you to connect a CCTV or live camera stream for
      real-time vehicle detection.
    </p>
    <button
      type="button"
      class="px-6 py-3 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition"
      disabled
      title="Coming soon"
    >
      🔗 Connect Now
    </button>
  </div>
</div>

<script>
  (function () {
    const input = document.getElementById("video-input");
    const preview = document.getElementById("video-preview");
    if (input && preview) {
      input.addEventListener("change", () => {
        const file = input.files && input.files[0];
        if (file) {
          const url = URL.createObjectURL(file);
          preview.src = url;
          preview.classList.remove("hidden");
        } else {
          preview.src = "";
          preview.classList.add("hidden");
        }
      });
    }
  })();
</script>

{% endblock %}
